"use strict";(self["webpackChunkforum_communautaire"]=self["webpackChunkforum_communautaire"]||[]).push([[198],{34(e,s,a){a.d(s,{A:()=>n});var l=a(144),i=a(768),t=a(51);const u=(e,s)=>{const a=(0,l.KR)(null),u=(0,l.KR)(null),n=(0,l.KR)(!1);let r=t.$_.collection(e);s&&(r=r.where(...s));const o=r.onSnapshot(e=>{let s=[];e.docs.forEach(e=>{e.data().createdAt&&s.push({...e.data(),id:e.id})}),a.value=s,u.value=null,n.value=!1},e=>{console.log(e.message),a.value=null,u.value="could not fetch the data",n.value=!1});return(0,i.nT)(e=>{e(()=>o())}),{error:u,documents:a,isPending:n}},n=u},198(e,s,a){a.r(s),a.d(s,{default:()=>A});var l=a(768),i=a(232),t=a(130);const u={class:"profile"},n={class:"profile-header"},r={class:"text-muted"},o={key:0,class:"error"},d={key:1,class:"success"},c={key:0},v={key:1},m={key:0},b={key:1},k={key:0,class:"success mt-3"},p={key:1,class:"error mt-3"},f={key:0,class:"text-center"},y={key:1},g=["onClick"],L={class:"discussion-stats"},h={key:2,class:"text-center py-4"},_={class:"stats-grid"},E={class:"stat-card"},F={class:"stat-card"},C={class:"stat-card"},R={class:"stat-card"};function D(e,s,a,D,w,P){const X=(0,l.g2)("b-form-input"),K=(0,l.g2)("b-form-group"),S=(0,l.g2)("b-form-textarea"),V=(0,l.g2)("b-spinner"),W=(0,l.g2)("b-button"),x=(0,l.g2)("b-form"),A=(0,l.g2)("b-tab"),N=(0,l.g2)("b-alert"),T=(0,l.g2)("b-tabs"),z=(0,l.g2)("b-card"),I=(0,l.g2)("b-col"),M=(0,l.g2)("b-row"),Q=(0,l.g2)("b-container");return(0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(Q,null,{default:(0,l.k6)(()=>[(0,l.bF)(M,null,{default:(0,l.k6)(()=>[(0,l.bF)(I,{lg:"8",class:"mx-auto"},{default:(0,l.k6)(()=>[(0,l.bF)(z,{class:"profile-card shadow-lg"},{header:(0,l.k6)(()=>[(0,l.Lk)("div",n,[s[2]||(s[2]=(0,l.Lk)("div",{class:"profile-avatar"},[(0,l.Lk)("i",{class:"bi bi-person-circle"})],-1)),(0,l.Lk)("div",null,[(0,l.Lk)("h2",null,(0,i.v_)(D.user?.displayName),1),(0,l.Lk)("p",r,(0,i.v_)(D.user?.email),1)])])]),default:(0,l.k6)(()=>[(0,l.bF)(T,{"content-class":"mt-4"},{default:(0,l.k6)(()=>[(0,l.bF)(A,{title:"Informations",active:""},{default:(0,l.k6)(()=>[(0,l.bF)(x,{onSubmit:(0,t.D$)(D.updateProfile,["prevent"])},{default:(0,l.k6)(()=>[(0,l.bF)(K,{label:"Nom d'affichage"},{default:(0,l.k6)(()=>[(0,l.bF)(X,{modelValue:D.displayName,"onUpdate:modelValue":s[0]||(s[0]=e=>D.displayName=e),placeholder:"Votre nom d'affichage"},null,8,["modelValue"])]),_:1}),(0,l.bF)(K,{label:"Email"},{default:(0,l.k6)(()=>[(0,l.bF)(X,{value:D.user?.email,disabled:""},null,8,["value"])]),_:1}),(0,l.bF)(K,{label:"Bio"},{default:(0,l.k6)(()=>[(0,l.bF)(S,{modelValue:D.bio,"onUpdate:modelValue":s[1]||(s[1]=e=>D.bio=e),placeholder:"Parlez-nous de vous...",rows:"4"},null,8,["modelValue"])]),_:1}),D.updateError?((0,l.uX)(),(0,l.CE)("div",o,(0,i.v_)(D.updateError),1)):(0,l.Q3)("",!0),D.updateSuccess?((0,l.uX)(),(0,l.CE)("div",d,"Profil mis à jour avec succès!")):(0,l.Q3)("",!0),(0,l.bF)(W,{type:"submit",variant:"primary",disabled:D.updatePending},{default:(0,l.k6)(()=>[D.updatePending?((0,l.uX)(),(0,l.CE)("span",v,[(0,l.bF)(V,{small:""}),s[3]||(s[3]=(0,l.eW)(" Mise à jour... ",-1))])):((0,l.uX)(),(0,l.CE)("span",c,"Mettre à jour"))]),_:1},8,["disabled"])]),_:1},8,["onSubmit"])]),_:1}),(0,l.bF)(A,{title:"Mot de passe"},{default:(0,l.k6)(()=>[(0,l.bF)(N,{variant:"info",show:""},{default:(0,l.k6)(()=>[...s[4]||(s[4]=[(0,l.Lk)("i",{class:"bi bi-info-circle"},null,-1),(0,l.eW)(" Pour changer votre mot de passe, vous recevrez un email avec un lien de réinitialisation. ",-1)])]),_:1}),(0,l.bF)(W,{variant:"warning",onClick:D.sendPasswordReset,disabled:D.resetPending},{default:(0,l.k6)(()=>[D.resetPending?((0,l.uX)(),(0,l.CE)("span",b,[(0,l.bF)(V,{small:""}),s[6]||(s[6]=(0,l.eW)(" Envoi... ",-1))])):((0,l.uX)(),(0,l.CE)("span",m,[...s[5]||(s[5]=[(0,l.Lk)("i",{class:"bi bi-envelope"},null,-1),(0,l.eW)(" Envoyer l'email de réinitialisation ",-1)])]))]),_:1},8,["onClick","disabled"]),D.resetSuccess?((0,l.uX)(),(0,l.CE)("div",k," Email de réinitialisation envoyé! Vérifiez votre boîte de réception. ")):(0,l.Q3)("",!0),D.resetError?((0,l.uX)(),(0,l.CE)("div",p,(0,i.v_)(D.resetError),1)):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(A,{title:"Mes Discussions"},{default:(0,l.k6)(()=>[D.myDiscussionsLoading?((0,l.uX)(),(0,l.CE)("div",f,[...s[7]||(s[7]=[(0,l.Lk)("div",{class:"spinner"},null,-1),(0,l.Lk)("p",null,"Chargement de vos discussions...",-1)])])):D.myDiscussions&&D.myDiscussions.length?((0,l.uX)(),(0,l.CE)("div",y,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(D.myDiscussions,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"my-discussion-item",onClick:s=>D.goToDiscussion(e.id)},[(0,l.Lk)("h5",null,(0,i.v_)(e.title),1),(0,l.Lk)("div",L,[(0,l.Lk)("span",null,[s[8]||(s[8]=(0,l.Lk)("i",{class:"bi bi-chat"},null,-1)),(0,l.eW)(" "+(0,i.v_)(e.replies||0),1)]),(0,l.Lk)("span",null,[s[9]||(s[9]=(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)),(0,l.eW)(" "+(0,i.v_)(e.views||0),1)]),(0,l.Lk)("span",null,[s[10]||(s[10]=(0,l.Lk)("i",{class:"bi bi-calendar"},null,-1)),(0,l.eW)(" "+(0,i.v_)(D.formatDate(e.createdAt)),1)])])],8,g))),128))])):((0,l.uX)(),(0,l.CE)("div",h,[s[12]||(s[12]=(0,l.Lk)("i",{class:"bi bi-chat-text",style:{"font-size":"3rem",color:"#ccc"}},null,-1)),s[13]||(s[13]=(0,l.Lk)("p",{class:"text-muted mt-2"},"Vous n'avez pas encore créé de discussion",-1)),(0,l.bF)(W,{variant:"primary",to:"/create-discussion"},{default:(0,l.k6)(()=>[...s[11]||(s[11]=[(0,l.eW)(" Créer une discussion ",-1)])]),_:1})]))]),_:1}),(0,l.bF)(A,{title:"Statistiques"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",_,[(0,l.Lk)("div",E,[s[14]||(s[14]=(0,l.Lk)("i",{class:"bi bi-chat-dots"},null,-1)),(0,l.Lk)("h3",null,(0,i.v_)(D.myDiscussions?.length||0),1),s[15]||(s[15]=(0,l.Lk)("p",null,"Discussions créées",-1))]),(0,l.Lk)("div",F,[s[16]||(s[16]=(0,l.Lk)("i",{class:"bi bi-chat-left-text"},null,-1)),(0,l.Lk)("h3",null,(0,i.v_)(D.myReplies?.length||0),1),s[17]||(s[17]=(0,l.Lk)("p",null,"Réponses données",-1))]),(0,l.Lk)("div",C,[s[18]||(s[18]=(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)),(0,l.Lk)("h3",null,(0,i.v_)(D.totalViews),1),s[19]||(s[19]=(0,l.Lk)("p",null,"Vues totales",-1))]),(0,l.Lk)("div",R,[s[20]||(s[20]=(0,l.Lk)("i",{class:"bi bi-calendar"},null,-1)),(0,l.Lk)("h3",null,(0,i.v_)(D.memberSince),1),s[21]||(s[21]=(0,l.Lk)("p",null,"Membre depuis",-1))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}var w=a(144),P=a(728),X=a(573),K=a(34),S=a(51);const V={name:"Profile",setup(){const{user:e}=(0,X.A)(),s=(0,P.rd)(),a=(0,w.KR)(e.value?.displayName||""),i=(0,w.KR)(""),t=(0,w.KR)(!1),u=(0,w.KR)(null),n=(0,w.KR)(!1),r=(0,w.KR)(!1),o=(0,w.KR)(null),d=(0,w.KR)(!1),{documents:c,isPending:v}=(0,K.A)("discussions",["authorId","==",e.value?.uid]),{documents:m}=(0,K.A)("replies",["authorId","==",e.value?.uid]),b=(0,l.EW)(()=>c.value?c.value.reduce((e,s)=>e+(s.views||0),0):0),k=(0,l.EW)(()=>{if(!e.value?.metadata?.creationTime)return"Récent";const s=new Date(e.value.metadata.creationTime);return s.toLocaleDateString("fr-FR",{month:"short",year:"numeric"})}),p=async()=>{t.value=!0,u.value=null,n.value=!1;try{await e.value.updateProfile({displayName:a.value}),n.value=!0,setTimeout(()=>{n.value=!1},3e3)}catch(s){u.value=s.message}finally{t.value=!1}},f=async()=>{r.value=!0,o.value=null,d.value=!1;try{await S.e8.sendPasswordResetEmail(e.value.email),d.value=!0}catch(s){o.value=s.message}finally{r.value=!1}},y=e=>e?e.toDate().toLocaleDateString("fr-FR"):"",g=e=>{s.push({name:"Discussion",params:{id:e}})};return{user:e,displayName:a,bio:i,updatePending:t,updateError:u,updateSuccess:n,resetPending:r,resetError:o,resetSuccess:d,myDiscussions:c,myDiscussionsLoading:v,myReplies:m,totalViews:b,memberSince:k,updateProfile:p,sendPasswordReset:f,formatDate:y,goToDiscussion:g}}};var W=a(241);const x=(0,W.A)(V,[["render",D],["__scopeId","data-v-074e7410"]]),A=x}}]);
//# sourceMappingURL=198.96634c56.js.map