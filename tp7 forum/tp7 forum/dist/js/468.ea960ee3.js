"use strict";(self["webpackChunkforum_communautaire"]=self["webpackChunkforum_communautaire"]||[]).push([[468],{34(e,t,s){s.d(t,{A:()=>o});var l=s(144),i=s(768),a=s(51);const n=(e,t)=>{const s=(0,l.KR)(null),n=(0,l.KR)(null),o=(0,l.KR)(!1);let r=a.$_.collection(e);t&&(r=r.where(...t));const c=r.onSnapshot(e=>{let t=[];e.docs.forEach(e=>{e.data().createdAt&&t.push({...e.data(),id:e.id})}),s.value=t,n.value=null,o.value=!1},e=>{console.log(e.message),s.value=null,n.value="could not fetch the data",o.value=!1});return(0,i.nT)(e=>{e(()=>c())}),{error:n,documents:s,isPending:o}},o=n},312(e,t,s){s.d(t,{A:()=>n});var l=s(144),i=s(51);const a=()=>{const e=(0,l.KR)(null),t=(0,l.KR)(!1),s=async s=>{e.value=null,t.value=!0;try{const e=await i.$_.collection("discussions").add({...s,createdAt:(0,i.vE)(),replies:0,views:0,reported:!1,reportCount:0});return t.value=!1,e}catch(l){console.error(l.message),e.value="Could not create discussion",t.value=!1}},a=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection("discussions").doc(s).update({...l,updatedAt:(0,i.vE)()}),t.value=!1}catch(a){console.error(a.message),e.value="Could not update discussion",t.value=!1}},n=async s=>{e.value=null,t.value=!0;try{await i.$_.collection("discussions").doc(s).delete();const e=await i.$_.collection("replies").where("discussionId","==",s).get(),l=i.$_.batch();e.docs.forEach(e=>{l.delete(e.ref)}),await l.commit(),t.value=!1}catch(l){console.error(l.message),e.value="Could not delete discussion",t.value=!1}},o=async e=>{try{await i.$_.collection("discussions").doc(e).update({views:i.$_.FieldValue.increment(1)})}catch(t){console.error("Could not increment views:",t.message)}};return{error:e,isPending:t,createDiscussion:s,updateDiscussion:a,deleteDiscussion:n,incrementViews:o}},n=a},468(e,t,s){s.r(t),s.d(t,{default:()=>A});var l=s(768),i=s(232);const a={class:"moderation"},n={key:0,class:"text-center"},o={key:1},r={key:2,class:"text-center py-5"},c={key:0,class:"text-center"},u={key:1},d={key:2,class:"text-center py-5"},p={key:0,class:"text-center"},v={key:1};function m(e,t,s,m,k,g){const b=(0,l.g2)("b-alert"),y=(0,l.g2)("router-link"),_=(0,l.g2)("b-badge"),f=(0,l.g2)("b-button"),C=(0,l.g2)("b-table"),h=(0,l.g2)("b-tab"),A=(0,l.g2)("b-pagination"),D=(0,l.g2)("b-tabs"),F=(0,l.g2)("b-container");return(0,l.uX)(),(0,l.CE)("div",a,[(0,l.bF)(F,null,{default:(0,l.k6)(()=>[t[12]||(t[12]=(0,l.Lk)("h1",{class:"mb-4"},[(0,l.Lk)("i",{class:"bi bi-shield-check"}),(0,l.eW)(" Panneau de Modération ")],-1)),(0,l.bF)(b,{variant:"info",show:""},{default:(0,l.k6)(()=>[...t[1]||(t[1]=[(0,l.Lk)("i",{class:"bi bi-info-circle"},null,-1),(0,l.eW)(" En tant que modérateur, vous pouvez gérer les contenus signalés et supprimer les messages inappropriés. ",-1)])]),_:1}),(0,l.bF)(D,{"content-class":"mt-4"},{default:(0,l.k6)(()=>[(0,l.bF)(h,{title:"Discussions Signalées",active:""},{default:(0,l.k6)(()=>[m.reportedDiscussionsLoading?((0,l.uX)(),(0,l.CE)("div",n,[...t[2]||(t[2]=[(0,l.Lk)("div",{class:"spinner"},null,-1),(0,l.Lk)("p",null,"Chargement...",-1)])])):m.reportedDiscussions&&m.reportedDiscussions.length?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(C,{items:m.reportedDiscussions,fields:m.discussionFields,striped:"",hover:"",responsive:""},{"cell(title)":(0,l.k6)(e=>[(0,l.bF)(y,{to:`/discussion/${e.item.id}`},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.item.title),1)]),_:2},1032,["to"])]),"cell(reportCount)":(0,l.k6)(e=>[(0,l.bF)(_,{variant:"danger"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.item.reportCount||1),1)]),_:2},1024)]),"cell(createdAt)":(0,l.k6)(e=>[(0,l.eW)((0,i.v_)(m.formatDate(e.item.createdAt)),1)]),"cell(actions)":(0,l.k6)(e=>[(0,l.bF)(f,{variant:"success",size:"sm",onClick:t=>m.unreportDiscussion(e.item.id),class:"me-2"},{default:(0,l.k6)(()=>[...t[3]||(t[3]=[(0,l.Lk)("i",{class:"bi bi-check"},null,-1),(0,l.eW)(" Approuver ",-1)])]),_:1},8,["onClick"]),(0,l.bF)(f,{variant:"danger",size:"sm",onClick:t=>m.deleteDiscussion(e.item.id)},{default:(0,l.k6)(()=>[...t[4]||(t[4]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1),(0,l.eW)(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items","fields"])])):((0,l.uX)(),(0,l.CE)("div",r,[...t[5]||(t[5]=[(0,l.Lk)("i",{class:"bi bi-check-circle",style:{"font-size":"4rem",color:"#4caf50"}},null,-1),(0,l.Lk)("h4",{class:"mt-3"},"Aucune discussion signalée",-1),(0,l.Lk)("p",{class:"text-muted"},"Tout est en ordre!",-1)])]))]),_:1}),(0,l.bF)(h,{title:"Réponses Signalées"},{default:(0,l.k6)(()=>[m.reportedRepliesLoading?((0,l.uX)(),(0,l.CE)("div",c,[...t[6]||(t[6]=[(0,l.Lk)("div",{class:"spinner"},null,-1),(0,l.Lk)("p",null,"Chargement...",-1)])])):m.reportedReplies&&m.reportedReplies.length?((0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(C,{items:m.reportedReplies,fields:m.replyFields,striped:"",hover:"",responsive:""},{"cell(content)":(0,l.k6)(e=>[(0,l.eW)((0,i.v_)(m.truncate(e.item.content,100)),1)]),"cell(reportCount)":(0,l.k6)(e=>[(0,l.bF)(_,{variant:"danger"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.item.reportCount||1),1)]),_:2},1024)]),"cell(createdAt)":(0,l.k6)(e=>[(0,l.eW)((0,i.v_)(m.formatDate(e.item.createdAt)),1)]),"cell(actions)":(0,l.k6)(e=>[(0,l.bF)(f,{variant:"success",size:"sm",onClick:t=>m.unreportReply(e.item.id),class:"me-2"},{default:(0,l.k6)(()=>[...t[7]||(t[7]=[(0,l.Lk)("i",{class:"bi bi-check"},null,-1),(0,l.eW)(" Approuver ",-1)])]),_:1},8,["onClick"]),(0,l.bF)(f,{variant:"danger",size:"sm",onClick:t=>m.deleteReply(e.item.id,e.item.discussionId)},{default:(0,l.k6)(()=>[...t[8]||(t[8]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1),(0,l.eW)(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items","fields"])])):((0,l.uX)(),(0,l.CE)("div",d,[...t[9]||(t[9]=[(0,l.Lk)("i",{class:"bi bi-check-circle",style:{"font-size":"4rem",color:"#4caf50"}},null,-1),(0,l.Lk)("h4",{class:"mt-3"},"Aucune réponse signalée",-1),(0,l.Lk)("p",{class:"text-muted"},"Tout est en ordre!",-1)])]))]),_:1}),(0,l.bF)(h,{title:"Toutes les Discussions"},{default:(0,l.k6)(()=>[m.allDiscussionsLoading?((0,l.uX)(),(0,l.CE)("div",p,[...t[10]||(t[10]=[(0,l.Lk)("div",{class:"spinner"},null,-1),(0,l.Lk)("p",null,"Chargement...",-1)])])):m.allDiscussions&&m.allDiscussions.length?((0,l.uX)(),(0,l.CE)("div",v,[(0,l.bF)(C,{items:m.allDiscussions,fields:m.allDiscussionFields,striped:"",hover:"",responsive:"","per-page":10,"current-page":m.currentPage},{"cell(title)":(0,l.k6)(e=>[(0,l.bF)(y,{to:`/discussion/${e.item.id}`},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.item.title),1)]),_:2},1032,["to"])]),"cell(reported)":(0,l.k6)(e=>[(0,l.bF)(_,{variant:e.item.reported?"danger":"success"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.item.reported?"Oui":"Non"),1)]),_:2},1032,["variant"])]),"cell(createdAt)":(0,l.k6)(e=>[(0,l.eW)((0,i.v_)(m.formatDate(e.item.createdAt)),1)]),"cell(actions)":(0,l.k6)(e=>[(0,l.bF)(f,{variant:"danger",size:"sm",onClick:t=>m.deleteDiscussion(e.item.id)},{default:(0,l.k6)(()=>[...t[11]||(t[11]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1),(0,l.eW)(" Supprimer ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items","fields","current-page"]),(0,l.bF)(A,{modelValue:m.currentPage,"onUpdate:modelValue":t[0]||(t[0]=e=>m.currentPage=e),"total-rows":m.allDiscussions.length,"per-page":10,align:"center"},null,8,["modelValue","total-rows"])])):(0,l.Q3)("",!0)]),_:1})]),_:1})]),_:1})])}var k=s(144),g=s(34),b=s(997),y=s(312),_=s(609);const f={name:"Moderation",setup(){const{unreportContent:e}=(0,b.A)(),{deleteDiscussion:t}=(0,y.A)(),{deleteReply:s}=(0,_.A)(),{documents:l,isPending:i}=(0,g.A)("discussions",["reported","==",!0]),{documents:a,isPending:n}=(0,g.A)("replies",["reported","==",!0]),{documents:o,isPending:r}=(0,g.A)("discussions"),c=(0,k.KR)(1),u=[{key:"title",label:"Titre"},{key:"authorName",label:"Auteur"},{key:"reportCount",label:"Signalements"},{key:"createdAt",label:"Date"},{key:"actions",label:"Actions"}],d=[{key:"content",label:"Contenu"},{key:"authorName",label:"Auteur"},{key:"reportCount",label:"Signalements"},{key:"createdAt",label:"Date"},{key:"actions",label:"Actions"}],p=[{key:"title",label:"Titre"},{key:"authorName",label:"Auteur"},{key:"category",label:"Catégorie"},{key:"reported",label:"Signalé"},{key:"createdAt",label:"Date"},{key:"actions",label:"Actions"}],v=e=>e?e.toDate().toLocaleDateString("fr-FR"):"",m=(e,t)=>e.length>t?e.substring(0,t)+"...":e,f=async t=>{confirm("Approuver cette discussion?")&&await e("discussions",t)},C=async t=>{confirm("Approuver cette réponse?")&&await e("replies",t)},h=async e=>{confirm("Supprimer définitivement cette discussion?")&&await t(e)},A=async(e,t)=>{confirm("Supprimer définitivement cette réponse?")&&await s(e,t)};return{reportedDiscussions:l,reportedDiscussionsLoading:i,reportedReplies:a,reportedRepliesLoading:n,allDiscussions:o,allDiscussionsLoading:r,currentPage:c,discussionFields:u,replyFields:d,allDiscussionFields:p,formatDate:v,truncate:m,unreportDiscussion:f,unreportReply:C,deleteDiscussion:h,deleteReply:A}}};var C=s(241);const h=(0,C.A)(f,[["render",m],["__scopeId","data-v-19f80d2e"]]),A=h},609(e,t,s){s.d(t,{A:()=>n});var l=s(144),i=s(51);const a=()=>{const e=(0,l.KR)(null),t=(0,l.KR)(!1),s=async s=>{e.value=null,t.value=!0;try{const e=await i.$_.collection("replies").add({...s,createdAt:(0,i.vE)(),reported:!1,reportCount:0});return await i.$_.collection("discussions").doc(s.discussionId).update({replies:i.$_.FieldValue.increment(1),lastReplyAt:(0,i.vE)()}),t.value=!1,e}catch(l){console.error(l.message),e.value="Could not create reply",t.value=!1}},a=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection("replies").doc(s).update({...l,updatedAt:(0,i.vE)()}),t.value=!1}catch(a){console.error(a.message),e.value="Could not update reply",t.value=!1}},n=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection("replies").doc(s).delete(),await i.$_.collection("discussions").doc(l).update({replies:i.$_.FieldValue.increment(-1)}),t.value=!1}catch(a){console.error(a.message),e.value="Could not delete reply",t.value=!1}};return{error:e,isPending:t,createReply:s,updateReply:a,deleteReply:n}},n=a},997(e,t,s){s.d(t,{A:()=>n});var l=s(144),i=s(51);const a=()=>{const e=(0,l.KR)(null),t=(0,l.KR)(!1),s=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection(s).doc(l).update({reported:!0,reportCount:i.$_.FieldValue.increment(1)}),t.value=!1}catch(a){console.error(a.message),e.value="Could not report content",t.value=!1}},a=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection(s).doc(l).update({reported:!1,reportCount:0}),t.value=!1}catch(a){console.error(a.message),e.value="Could not unreport content",t.value=!1}},n=async(s,l)=>{e.value=null,t.value=!0;try{await i.$_.collection(s).doc(l).delete(),t.value=!1}catch(a){console.error(a.message),e.value="Could not delete content",t.value=!1}};return{error:e,isPending:t,reportContent:s,unreportContent:a,deleteContent:n}},n=a}}]);
//# sourceMappingURL=468.ea960ee3.js.map