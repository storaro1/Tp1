"use strict";(self["webpackChunkforum_communautaire"]=self["webpackChunkforum_communautaire"]||[]).push([[32],{32(e,l,t){t.r(l),t.d(l,{default:()=>we});var a=t(768),s=t(232),n=t(130);const o={class:"discussion-view"},r={class:"discussion-container"},i={key:0,class:"loading-state"},c={key:1,class:"error-message"},d={key:2,class:"discussion-content-wrapper"},u={class:"discussion-card"},p={class:"discussion-header"},v={class:"discussion-header-content"},m={class:"discussion-title"},y={class:"discussion-meta"},k={class:"meta-item"},h={class:"author-avatar"},b={class:"author-name"},g={class:"meta-item"},L={class:"meta-item"},C={class:"meta-item"},f={key:0,class:"discussion-actions"},R={class:"discussion-body"},w={class:"discussion-footer"},E={class:"replies-section"},_={class:"replies-header"},A={class:"reply-count"},D={class:"reply-form-card"},$={class:"form-header"},K={class:"user-avatar-small"},X={class:"form-footer"},M={class:"char-count"},I=["disabled"],x={key:0},N={key:1},S={key:0,class:"replies-list"},U={key:1,class:"empty-state"},P={class:"modal-header"},F={class:"modal-body"},W={class:"form-group"},V={class:"form-group"},T={class:"modal-footer"},Q={class:"modal-header"},q={class:"modal-body"},z={class:"form-group"},J={class:"modal-footer"};function j(e,l,t,j,B,O){const G=(0,a.g2)("Navbar"),H=(0,a.g2)("router-link"),Y=(0,a.g2)("ReplyCard");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(G),(0,a.Lk)("div",r,[j.isPending?((0,a.uX)(),(0,a.CE)("div",i,[...l[18]||(l[18]=[(0,a.Lk)("div",{class:"spinner"},null,-1),(0,a.Lk)("p",null,"Chargement de la discussion...",-1)])])):j.error?((0,a.uX)(),(0,a.CE)("div",c,[l[19]||(l[19]=(0,a.Lk)("i",{class:"bi bi-exclamation-triangle-fill"},null,-1)),(0,a.Lk)("span",null,(0,s.v_)(j.error),1)])):j.document?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(H,{to:"/home",class:"back-link"},{default:(0,a.k6)(()=>[...l[20]||(l[20]=[(0,a.Lk)("i",{class:"bi bi-arrow-left"},null,-1),(0,a.eW)(" Retour aux discussions ",-1)])]),_:1}),(0,a.Lk)("div",u,[(0,a.Lk)("div",p,[(0,a.Lk)("div",v,[(0,a.Lk)("div",{class:"category-badge",style:(0,s.Tr)({background:j.getCategoryColor(j.document.category)})},[(0,a.Lk)("i",{class:(0,s.C4)(j.getCategoryIcon(j.document.category))},null,2),(0,a.eW)(" "+(0,s.v_)(j.getCategoryName(j.document.category)),1)],4),(0,a.Lk)("h1",m,(0,s.v_)(j.document.title),1),(0,a.Lk)("div",y,[(0,a.Lk)("div",k,[(0,a.Lk)("div",h,(0,s.v_)(j.document.authorName?j.document.authorName.charAt(0).toUpperCase():"A"),1),(0,a.Lk)("span",b,(0,s.v_)(j.document.authorName),1)]),l[24]||(l[24]=(0,a.Lk)("div",{class:"meta-separator"},"•",-1)),(0,a.Lk)("div",g,[l[21]||(l[21]=(0,a.Lk)("i",{class:"bi bi-clock"},null,-1)),(0,a.eW)(" "+(0,s.v_)(j.formatDate(j.document.createdAt)),1)]),l[25]||(l[25]=(0,a.Lk)("div",{class:"meta-separator"},"•",-1)),(0,a.Lk)("div",L,[l[22]||(l[22]=(0,a.Lk)("i",{class:"bi bi-eye"},null,-1)),(0,a.eW)(" "+(0,s.v_)(j.document.views||0)+" vues ",1)]),l[26]||(l[26]=(0,a.Lk)("div",{class:"meta-separator"},"•",-1)),(0,a.Lk)("div",C,[l[23]||(l[23]=(0,a.Lk)("i",{class:"bi bi-chat-dots"},null,-1)),(0,a.eW)(" "+(0,s.v_)(j.replies?j.replies.length:0)+" réponses ",1)])])]),j.user&&j.user.uid===j.document.authorId?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("button",{class:"action-btn edit-btn",onClick:l[0]||(l[0]=e=>j.showEditModal=!0)},[...l[27]||(l[27]=[(0,a.Lk)("i",{class:"bi bi-pencil"},null,-1)])]),(0,a.Lk)("button",{class:"action-btn delete-btn",onClick:l[1]||(l[1]=(...e)=>j.confirmDelete&&j.confirmDelete(...e))},[...l[28]||(l[28]=[(0,a.Lk)("i",{class:"bi bi-trash"},null,-1)])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",R,[(0,a.Lk)("p",null,(0,s.v_)(j.document.content),1)]),(0,a.Lk)("div",w,[j.user&&j.user.uid!==j.document.authorId?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"report-btn",onClick:l[2]||(l[2]=(...e)=>j.reportDiscussion&&j.reportDiscussion(...e))},[...l[29]||(l[29]=[(0,a.Lk)("i",{class:"bi bi-flag"},null,-1),(0,a.eW)(" Signaler ",-1)])])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",E,[(0,a.Lk)("div",_,[(0,a.Lk)("h2",null,[l[30]||(l[30]=(0,a.Lk)("i",{class:"bi bi-chat-left-dots-fill"},null,-1)),l[31]||(l[31]=(0,a.eW)(" Réponses ",-1)),(0,a.Lk)("span",A,(0,s.v_)(j.replies?j.replies.length:0),1)])]),(0,a.Lk)("div",D,[(0,a.Lk)("form",{onSubmit:l[4]||(l[4]=(0,n.D$)((...e)=>j.handleReply&&j.handleReply(...e),["prevent"])),class:"reply-form"},[(0,a.Lk)("div",$,[(0,a.Lk)("div",K,(0,s.v_)(j.user?.displayName?j.user.displayName.charAt(0).toUpperCase():"U"),1),l[32]||(l[32]=(0,a.Lk)("span",{class:"form-label"},"Écrire une réponse",-1))]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[3]||(l[3]=e=>j.replyContent=e),class:"reply-textarea",placeholder:"Partagez votre point de vue, posez une question ou aidez les autres...",rows:"4",required:""},null,512),[[n.Jo,j.replyContent]]),(0,a.Lk)("div",X,[(0,a.Lk)("div",M,(0,s.v_)(j.replyContent.length)+" caractères",1),(0,a.Lk)("button",{type:"submit",class:"submit-btn",disabled:j.replyPending||!j.replyContent.trim()},[j.replyPending?((0,a.uX)(),(0,a.CE)("span",N,[...l[34]||(l[34]=[(0,a.Lk)("div",{class:"spinner-small"},null,-1),(0,a.eW)(" Envoi... ",-1)])])):((0,a.uX)(),(0,a.CE)("span",x,[...l[33]||(l[33]=[(0,a.Lk)("i",{class:"bi bi-send-fill"},null,-1),(0,a.eW)(" Publier ",-1)])]))],8,I)])],32)]),j.replies&&j.replies.length?((0,a.uX)(),(0,a.CE)("div",S,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(j.replies,e=>((0,a.uX)(),(0,a.Wv)(Y,{key:e.id,reply:e,currentUser:j.user,onDelete:j.handleDeleteReply,onEdit:j.handleEditReply,onReport:j.handleReportReply},null,8,["reply","currentUser","onDelete","onEdit","onReport"]))),128))])):((0,a.uX)(),(0,a.CE)("div",U,[...l[35]||(l[35]=[(0,a.Lk)("i",{class:"bi bi-chat-text"},null,-1),(0,a.Lk)("h3",null,"Aucune réponse pour le moment",-1),(0,a.Lk)("p",null,"Soyez le premier à partager votre avis!",-1)])]))])])):(0,a.Q3)("",!0)]),(0,a.bF)(n.eB,{name:"modal-fade"},{default:(0,a.k6)(()=>[j.showEditModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:l[11]||(l[11]=e=>j.showEditModal=!1)},[(0,a.Lk)("div",{class:"modal-card",onClick:l[10]||(l[10]=(0,n.D$)(()=>{},["stop"]))},[(0,a.Lk)("div",P,[l[37]||(l[37]=(0,a.Lk)("h3",null,"Modifier la discussion",-1)),(0,a.Lk)("button",{class:"modal-close",onClick:l[5]||(l[5]=e=>j.showEditModal=!1)},[...l[36]||(l[36]=[(0,a.Lk)("i",{class:"bi bi-x-lg"},null,-1)])])]),(0,a.Lk)("div",F,[(0,a.Lk)("div",W,[l[38]||(l[38]=(0,a.Lk)("label",null,"Titre",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":l[6]||(l[6]=e=>j.editTitle=e),type:"text",class:"modern-input"},null,512),[[n.Jo,j.editTitle]])]),(0,a.Lk)("div",V,[l[39]||(l[39]=(0,a.Lk)("label",null,"Contenu",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[7]||(l[7]=e=>j.editContent=e),rows:"6",class:"modern-textarea"},null,512),[[n.Jo,j.editContent]])])]),(0,a.Lk)("div",T,[(0,a.Lk)("button",{class:"btn-secondary",onClick:l[8]||(l[8]=e=>j.showEditModal=!1)},"Annuler"),(0,a.Lk)("button",{class:"btn-primary",onClick:l[9]||(l[9]=(...e)=>j.handleEdit&&j.handleEdit(...e))},"Enregistrer")])])])):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(n.eB,{name:"modal-fade"},{default:(0,a.k6)(()=>[j.showEditReplyModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:l[17]||(l[17]=e=>j.showEditReplyModal=!1)},[(0,a.Lk)("div",{class:"modal-card",onClick:l[16]||(l[16]=(0,n.D$)(()=>{},["stop"]))},[(0,a.Lk)("div",Q,[l[41]||(l[41]=(0,a.Lk)("h3",null,"Modifier la réponse",-1)),(0,a.Lk)("button",{class:"modal-close",onClick:l[12]||(l[12]=e=>j.showEditReplyModal=!1)},[...l[40]||(l[40]=[(0,a.Lk)("i",{class:"bi bi-x-lg"},null,-1)])])]),(0,a.Lk)("div",q,[(0,a.Lk)("div",z,[l[42]||(l[42]=(0,a.Lk)("label",null,"Contenu",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":l[13]||(l[13]=e=>j.editReplyContent=e),rows:"6",class:"modern-textarea"},null,512),[[n.Jo,j.editReplyContent]])])]),(0,a.Lk)("div",J,[(0,a.Lk)("button",{class:"btn-secondary",onClick:l[14]||(l[14]=e=>j.showEditReplyModal=!1)},"Annuler"),(0,a.Lk)("button",{class:"btn-primary",onClick:l[15]||(l[15]=(...e)=>j.saveEditReply&&j.saveEditReply(...e))},"Enregistrer")])])])):(0,a.Q3)("",!0)]),_:1})])}var B=t(144),O=t(728),G=t(859),H=t(51);const Y=(e,l)=>{const t=(0,B.KR)(null),s=(0,B.KR)(null),n=(0,B.KR)(!1);let o=H.$_.collection(e).doc(l);const r=o.onSnapshot(e=>{e.data()?(t.value={...e.data(),id:e.id},s.value=null,n.value=!1):(s.value="That document does not exist",n.value=!1)},e=>{console.log(e.message),s.value="Could not fetch the document",n.value=!1});return(0,a.nT)(e=>{e(()=>r())}),{error:s,document:t,isPending:n}},Z=Y;var ee=t(34),le=t(573),te=t(312),ae=t(609),se=t(997);const ne={class:"reply-card"},oe={class:"reply-header"},re={class:"reply-author"},ie={class:"author-avatar"},ce={class:"author-info"},de={class:"author-name"},ue={class:"reply-date"},pe={class:"reply-actions"},ve={key:0},me={key:1},ye={class:"reply-content"},ke={key:0,class:"reply-reported"};function he(e,l,t,n,o,r){return(0,a.uX)(),(0,a.CE)("div",ne,[(0,a.Lk)("div",oe,[(0,a.Lk)("div",re,[(0,a.Lk)("div",ie,(0,s.v_)(t.reply.authorName?t.reply.authorName.charAt(0).toUpperCase():"A"),1),(0,a.Lk)("div",ce,[(0,a.Lk)("span",de,(0,s.v_)(t.reply.authorName),1),(0,a.Lk)("span",ue,(0,s.v_)(n.formatDate(t.reply.createdAt)),1)])]),(0,a.Lk)("div",pe,[t.currentUser&&t.currentUser.uid===t.reply.authorId?((0,a.uX)(),(0,a.CE)("div",ve,[(0,a.Lk)("button",{class:"action-btn edit",onClick:l[0]||(l[0]=l=>e.$emit("edit",t.reply)),title:"Modifier"},[...l[3]||(l[3]=[(0,a.Lk)("i",{class:"bi bi-pencil"},null,-1)])]),(0,a.Lk)("button",{class:"action-btn delete",onClick:l[1]||(l[1]=l=>e.$emit("delete",t.reply.id)),title:"Supprimer"},[...l[4]||(l[4]=[(0,a.Lk)("i",{class:"bi bi-trash"},null,-1)])])])):t.currentUser?((0,a.uX)(),(0,a.CE)("div",me,[(0,a.Lk)("button",{class:"action-btn report",onClick:l[2]||(l[2]=l=>e.$emit("report",t.reply.id)),title:"Signaler"},[...l[5]||(l[5]=[(0,a.Lk)("i",{class:"bi bi-flag"},null,-1)])])])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",ye,(0,s.v_)(t.reply.content),1),t.reply.reported?((0,a.uX)(),(0,a.CE)("div",ke,[...l[6]||(l[6]=[(0,a.Lk)("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),(0,a.eW)(" Signalé ",-1)])])):(0,a.Q3)("",!0)])}const be={name:"ReplyCard",props:{reply:{type:Object,required:!0},currentUser:{type:Object,default:null}},emits:["delete","edit","report"],setup(){const e=e=>{if(!e)return"";const l=e.toDate(),t=new Date,a=t-l,s=Math.floor(a/6e4),n=Math.floor(a/36e5),o=Math.floor(a/864e5);return s<1?"À l'instant":s<60?`Il y a ${s} min`:n<24?`Il y a ${n}h`:o<7?`Il y a ${o}j`:l.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})};return{formatDate:e}}};var ge=t(241);const Le=(0,ge.A)(be,[["render",he],["__scopeId","data-v-06e690b2"]]),Ce=Le,fe={name:"DiscussionView",components:{Navbar:G.A,ReplyCard:Ce},props:["id"],setup(e){const{user:l}=(0,le.A)(),{document:t,error:s,isPending:n}=Z("discussions",e.id),{documents:o}=(0,ee.A)("replies",["discussionId","==",e.id]),{updateDiscussion:r,deleteDiscussion:i,incrementViews:c}=(0,te.A)(),{createReply:d,deleteReply:u,updateReply:p}=(0,ae.A)(),{reportContent:v}=(0,se.A)(),m=(0,O.rd)(),y=(0,a.EW)(()=>o.value?[...o.value].sort((e,l)=>e.createdAt&&l.createdAt?e.createdAt.seconds-l.createdAt.seconds:0):[]),k=(0,B.KR)(""),h=(0,B.KR)(!1),b=(0,B.KR)(!1),g=(0,B.KR)(""),L=(0,B.KR)(""),C=(0,B.KR)(!1),f=(0,B.KR)(null),R=(0,B.KR)("");c(e.id),(0,a.wB)(t,e=>{e&&(g.value=e.title,L.value=e.content)});const w=e=>e?e.toDate().toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",E=e=>{const l={general:"Général",tech:"Technologie",support:"Support",feedback:"Feedback",announcements:"Annonces",other:"Autres"};return l[e]||e},_=e=>{const l={general:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",tech:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",support:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",feedback:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",announcements:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",other:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"};return l[e]||l.other},A=e=>{const l={general:"bi-chat-dots-fill",tech:"bi-laptop",support:"bi-question-circle-fill",feedback:"bi-star-fill",announcements:"bi-megaphone-fill",other:"bi-three-dots"};return l[e]||l.other},D=async()=>{if(!k.value.trim())return;h.value=!0;const t={content:k.value,discussionId:e.id,authorId:l.value.uid,authorName:l.value.displayName||"Anonyme"};await d(t),s.value||(k.value=""),h.value=!1},$=async()=>{await r(e.id,{title:g.value,content:L.value}),b.value=!1},K=()=>{confirm("Êtes-vous sûr de vouloir supprimer cette discussion?")&&(i(e.id),m.push("/home"))},X=async()=>{confirm("Signaler cette discussion comme inappropriée?")&&(await v("discussions",e.id),alert("Discussion signalée. Les modérateurs examineront votre signalement."))},M=async l=>{confirm("Supprimer cette réponse?")&&await u(l,e.id)},I=e=>{f.value=e,R.value=e.content,C.value=!0},x=async()=>{R.value.trim()&&(await p(f.value.id,{content:R.value}),C.value=!1,f.value=null,R.value="")},N=async e=>{confirm("Signaler cette réponse comme inappropriée?")&&(await v("replies",e),alert("Réponse signalée."))};return{user:l,document:t,error:s,isPending:n,replies:y,replyContent:k,replyPending:h,showEditModal:b,editTitle:g,editContent:L,showEditReplyModal:C,editingReply:f,editReplyContent:R,formatDate:w,getCategoryName:E,getCategoryColor:_,getCategoryIcon:A,handleReply:D,handleEdit:$,confirmDelete:K,reportDiscussion:X,handleDeleteReply:M,handleEditReply:I,saveEditReply:x,handleReportReply:N}}},Re=(0,ge.A)(fe,[["render",j],["__scopeId","data-v-4bbd83d0"]]),we=Re},34(e,l,t){t.d(l,{A:()=>r});var a=t(144),s=t(768),n=t(51);const o=(e,l)=>{const t=(0,a.KR)(null),o=(0,a.KR)(null),r=(0,a.KR)(!1);let i=n.$_.collection(e);l&&(i=i.where(...l));const c=i.onSnapshot(e=>{let l=[];e.docs.forEach(e=>{e.data().createdAt&&l.push({...e.data(),id:e.id})}),t.value=l,o.value=null,r.value=!1},e=>{console.log(e.message),t.value=null,o.value="could not fetch the data",r.value=!1});return(0,s.nT)(e=>{e(()=>c())}),{error:o,documents:t,isPending:r}},r=o},312(e,l,t){t.d(l,{A:()=>o});var a=t(144),s=t(51);const n=()=>{const e=(0,a.KR)(null),l=(0,a.KR)(!1),t=async t=>{e.value=null,l.value=!0;try{const e=await s.$_.collection("discussions").add({...t,createdAt:(0,s.vE)(),replies:0,views:0,reported:!1,reportCount:0});return l.value=!1,e}catch(a){console.error(a.message),e.value="Could not create discussion",l.value=!1}},n=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection("discussions").doc(t).update({...a,updatedAt:(0,s.vE)()}),l.value=!1}catch(n){console.error(n.message),e.value="Could not update discussion",l.value=!1}},o=async t=>{e.value=null,l.value=!0;try{await s.$_.collection("discussions").doc(t).delete();const e=await s.$_.collection("replies").where("discussionId","==",t).get(),a=s.$_.batch();e.docs.forEach(e=>{a.delete(e.ref)}),await a.commit(),l.value=!1}catch(a){console.error(a.message),e.value="Could not delete discussion",l.value=!1}},r=async e=>{try{await s.$_.collection("discussions").doc(e).update({views:s.$_.FieldValue.increment(1)})}catch(l){console.error("Could not increment views:",l.message)}};return{error:e,isPending:l,createDiscussion:t,updateDiscussion:n,deleteDiscussion:o,incrementViews:r}},o=n},609(e,l,t){t.d(l,{A:()=>o});var a=t(144),s=t(51);const n=()=>{const e=(0,a.KR)(null),l=(0,a.KR)(!1),t=async t=>{e.value=null,l.value=!0;try{const e=await s.$_.collection("replies").add({...t,createdAt:(0,s.vE)(),reported:!1,reportCount:0});return await s.$_.collection("discussions").doc(t.discussionId).update({replies:s.$_.FieldValue.increment(1),lastReplyAt:(0,s.vE)()}),l.value=!1,e}catch(a){console.error(a.message),e.value="Could not create reply",l.value=!1}},n=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection("replies").doc(t).update({...a,updatedAt:(0,s.vE)()}),l.value=!1}catch(n){console.error(n.message),e.value="Could not update reply",l.value=!1}},o=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection("replies").doc(t).delete(),await s.$_.collection("discussions").doc(a).update({replies:s.$_.FieldValue.increment(-1)}),l.value=!1}catch(n){console.error(n.message),e.value="Could not delete reply",l.value=!1}};return{error:e,isPending:l,createReply:t,updateReply:n,deleteReply:o}},o=n},997(e,l,t){t.d(l,{A:()=>o});var a=t(144),s=t(51);const n=()=>{const e=(0,a.KR)(null),l=(0,a.KR)(!1),t=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection(t).doc(a).update({reported:!0,reportCount:s.$_.FieldValue.increment(1)}),l.value=!1}catch(n){console.error(n.message),e.value="Could not report content",l.value=!1}},n=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection(t).doc(a).update({reported:!1,reportCount:0}),l.value=!1}catch(n){console.error(n.message),e.value="Could not unreport content",l.value=!1}},o=async(t,a)=>{e.value=null,l.value=!0;try{await s.$_.collection(t).doc(a).delete(),l.value=!1}catch(n){console.error(n.message),e.value="Could not delete content",l.value=!1}};return{error:e,isPending:l,reportContent:t,unreportContent:n,deleteContent:o}},o=n}}]);
//# sourceMappingURL=32.238bd44e.js.map